<div class="payment-container">
  <div class="container">
    <!-- Success Message -->
    <div *ngIf="paymentSuccess" class="success-section">
      <div class="text-center py-5">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2 class="success-title">Pagamento Realizado com Sucesso!</h2>
        <p class="success-description">
          Seu pedido foi processado e você receberá os jogos em breve.
        </p>
        <div class="success-actions">
          <a routerLink="/catalogo" class="btn btn-primary btn-lg">
            <i class="fas fa-gamepad me-2"></i>
            Continuar Comprando
          </a>
        </div>
      </div>
    </div>

    <!-- Payment Form -->
    <div *ngIf="!paymentSuccess" class="payment-content">
      <!-- Empty Cart Message -->
      <div *ngIf="!cart?.cartGames?.length" class="empty-cart-message">
        <div class="text-center py-5">
          <div class="empty-cart-icon">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <h2 class="empty-cart-title">Carrinho Vazio</h2>
          <p class="empty-cart-description">
            Você não possui itens no carrinho para finalizar o pagamento.
          </p>
          <div class="empty-cart-actions">
            <a routerLink="/catalogo" class="btn btn-primary btn-lg">
              <i class="fas fa-gamepad me-2"></i>
              Ir para Catálogo
            </a>
          </div>
        </div>
      </div>

      <!-- Payment Form -->
      <div *ngIf="cart?.cartGames?.length">
      <div class="payment-header">
        <button type="button" class="btn btn-link back-btn" (click)="goBack()">
          <i class="fas fa-arrow-left me-2"></i>
          Voltar ao Carrinho
        </button>
        <h1 class="payment-title">
          <i class="fas fa-credit-card text-primary"></i>
          Pagamento
        </h1>
      </div>

      <div class="row">
        <!-- Order Summary -->
        <div class="col-lg-4">
          <div class="order-summary">
            <h4>Resumo do Pedido</h4>
            
            <div class="order-items" *ngIf="cart?.cartGames">
              <div class="order-item" *ngFor="let cartGame of cart?.cartGames">
                <div class="item-info">
                  <h6>{{ cartGame.game?.nome }}</h6>
                  <span class="item-quantity">Qtd: {{ cartGame.quantity }}</span>
                </div>
                <div class="item-price">
                  {{ formatPrice((cartGame.game?.valor || 0) * cartGame.quantity) }}
                </div>
              </div>
            </div>

            <div class="order-total">
              <div class="total-row">
                <span>Total:</span>
                <span class="total-price">{{ formatPrice(getTotal()) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Form -->
        <div class="col-lg-8">
          <form [formGroup]="paymentForm" class="payment-form">
            <h4>Forma de Pagamento</h4>
            
            <div class="payment-methods">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  id="creditCard" 
                  value="CREDIT_CARD"
                  formControlName="paymentMethod">
                <label class="form-check-label" for="creditCard">
                  <i class="fas fa-credit-card me-2"></i>
                  Cartão de Crédito
                </label>
              </div>
              
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="radio" 
                  id="pix" 
                  value="PIX"
                  formControlName="paymentMethod">
                <label class="form-check-label" for="pix">
                  <i class="fas fa-qrcode me-2"></i>
                  PIX
                </label>
              </div>
            </div>

            <!-- Credit Card Fields -->
            <div *ngIf="paymentForm.get('paymentMethod')?.value === 'CREDIT_CARD'" class="card-fields">
              <div class="form-group">
                <label for="cardNumber">Número do Cartão *</label>
                <input 
                  type="text" 
                  id="cardNumber"
                  class="form-control"
                  formControlName="cardNumber"
                  placeholder="1234 5678 9012 3456"
                  maxlength="19"
                  (input)="formatCardNumber($event)">
                <div *ngIf="paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched" class="error-message">
                  Número do cartão é obrigatório
                </div>
              </div>

              <div class="form-group">
                <label for="cardHolderName">Nome do Titular *</label>
                <input 
                  type="text" 
                  id="cardHolderName"
                  class="form-control"
                  formControlName="cardHolderName"
                  placeholder="NOME COMO NO CARTÃO">
                <div *ngIf="paymentForm.get('cardHolderName')?.invalid && paymentForm.get('cardHolderName')?.touched" class="error-message">
                  Nome do titular é obrigatório
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="cardExpiryMonth">Mês *</label>
                    <input 
                      type="number" 
                      id="cardExpiryMonth"
                      class="form-control"
                      formControlName="cardExpiryMonth"
                      placeholder="MM"
                      min="1" max="12">
                    <div *ngIf="paymentForm.get('cardExpiryMonth')?.invalid && paymentForm.get('cardExpiryMonth')?.touched" class="error-message">
                      Mês inválido
                    </div>
                  </div>
                </div>
                
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="cardExpiryYear">Ano *</label>
                    <input 
                      type="number" 
                      id="cardExpiryYear"
                      class="form-control"
                      formControlName="cardExpiryYear"
                      placeholder="AAAA"
                      min="2024">
                    <div *ngIf="paymentForm.get('cardExpiryYear')?.invalid && paymentForm.get('cardExpiryYear')?.touched" class="error-message">
                      Ano inválido
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="cardCvv">Código de Segurança *</label>
                    <input 
                      type="text" 
                      id="cardCvv"
                      class="form-control"
                      formControlName="cardCvv"
                      placeholder="123"
                      maxlength="4">
                    <div *ngIf="paymentForm.get('cardCvv')?.invalid && paymentForm.get('cardCvv')?.touched" class="error-message">
                      CVV é obrigatório
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- PIX Fields -->
            <div *ngIf="paymentForm.get('paymentMethod')?.value === 'PIX'" class="pix-fields">
              <div class="form-group">
                <label for="pixKey">Chave PIX *</label>
                <input 
                  type="text" 
                  id="pixKey"
                  class="form-control"
                  formControlName="pixKey"
                  placeholder="Digite sua chave PIX (CPF, email, telefone ou chave aleatória)">
                <div *ngIf="paymentForm.get('pixKey')?.invalid && paymentForm.get('pixKey')?.touched" class="error-message">
                  Chave PIX é obrigatória
                </div>
              </div>
              
              <div class="pix-info">
                <div class="info-box">
                  <i class="fas fa-info-circle me-2"></i>
                  <span>Após confirmar o pagamento, você será redirecionado para gerar o QR Code PIX</span>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="payment-actions">
              <button 
                type="button"
                class="btn btn-success btn-lg w-100"
                (click)="processPayment()"
                [disabled]="!paymentForm.valid || processingPayment">
                <span *ngIf="!processingPayment">
                  <i class="fas fa-lock me-2"></i>
                  Finalizar Pagamento - {{ formatPrice(getTotal()) }}
                </span>
                <span *ngIf="processingPayment">
                  <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Processando...</span>
                  </div>
                  Processando Pagamento...
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>

